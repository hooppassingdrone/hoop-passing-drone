<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Robotics Project Final Report</title>
    <link rel="stylesheet" href="css/styles.css">
    
    <!-- MathJax Script for LaTeX Equations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML" async></script>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [['$','$'], ['\\(','\\)']],
                displayMath: [['$$','$$'], ['\\[','\\]']],
                processEscapes: true
            }
        });
    </script>
</head>
<body>
    <header>
        <h1>Robotics Project Final Report</h1>
        <nav>
            <a href="#introduction">Introduction</a>
            <a href="#design">Design</a>
            <a href="#implementation">Implementation</a>
            <a href="#results">Results</a>
            <a href="#conclusion">Conclusion</a>
            <a href="#team">Team</a>
            <a href="#additional-materials">Additional Materials</a>
        </nav>
    </header>

    <main>
        <section id="introduction">
            <h2>Introduction</h2>
            <p>The goal of the project is to write up a controller that enables a DJI Tello drone to fly through a hula-hoop thrown in the air. 
                This problem is fascinating because we are using the Motion Capture system to get accturate position estimates, instead of using vision on the drone. </p>
            <p>An interesting aspect of this problem is predicting the hoop's trajectory and figuring out the most optimal feasible point for the drone to pass through the hoop while its airborne.</p>
            <p>
                This project is applicable for robotics problems involving dynamic target, such as missile tracking, where the drone must predict the missile's future trajectory, in order to better determine its future movement. This is applicable in any tracking feature, such as in sports games, where cameras must follow players and the ball, and determine the best pose to capture the game. 
                It could also be useful for emergency dynamic obstacle avoidance, where there are sudden obstacles that are in the way, and the drone must figure out the best way to avoid it. In our problem, we aim to go to the point, but the underlying tracking is similar. 
            </p>
            <div class="image-container">
                <img src="assets/images/goal.png" alt="Goal">
                <p class="image-caption">Figure 1: Overall Goal</p>
            </div>
            <!-- Example of a display equation -->
            <p>The key kinematic equation for our robot's motion is:
                $$\vec{v} = \frac{d\vec{r}}{dt} = \lim_{\Delta t \to 0} \frac{\Delta \vec{r}}{\Delta t}$$
            </p>
        </section>

        <section id="design">
            <h2>Design</h2>
            <p>Here are the main objectives/design criteria of the problem:</p>
            <ul class="formatted-list">
                <li>Drone to pass through hoop accurately and reliably; the drone should ideally pass through the middle of the hoop.</li>
                <li>Drone to efficiently pass through hoop. Drone should be able to pass through the hoop when feasible, and not always take the safest trajectory </li>
                <li>Ensure adaptability based on hoop throws. Able to adapt to different hoop trajectories, in terms of speed and apex height. </li>
            </ul>
            
            <!-- Image example -->
            <div class="image-container">
                <img src="assets/images/system_design.png" alt="System Design Diagram">
                <p class="image-caption">Figure 2: Overall system design architecture</p>
            </div>
            <p>Some of the design choices we had to make are: </p>
            <ul class="formatted-list">
                <li>Marker configuration on hoop and drone: The marker configuration on drone mattered more because we had to maintain the weight distribution while also having an asymmetric configuration for the Vicon tracking system to be able to identify the correct markers in the correct order. If the markers are in a symmetric configuration, then it will confuse the app to determine the correct markers, since multiple markers could correspond to the same one.</li>
                <li> Which feasible point to pick: First, the design choice was to determine the best feasible point using a cost function with certain factors that we will try to optimize, however due to the hardware constraints, we had to pick the safest/easiest trajectory to succeed, and this design choice eliminates the priority for efficiency, but could also improve safety by giving the drone as much time as possible. However, the hoop will also be going at its fastest speed at the feasible point we will pick. </li>
                <li> Trajectory prediction: This is an improtant design choice, where we tried multiple things and decided to go with least squares as our main technique for determining the future trajectotry of the hoop. We also had to think about the number of past positions to use for least squares, where there is a tradeoff between speed and accuracy, since the noise of the measurements will likely affect the solution more with sparse past positions. </li>
            </ul>
        </section>

        <section id="implementation">
            <h2>Implementation</h2>
            <p>Some of the design choices we had to make are: </p>
            <ul class="formatted-list">
                <li> 69 cm diameter hoop for the drone to fly through </li>
                <li> Drone: DJI Tello – controlled using Tello SDK, in order to fly autonomously fly through a predicted location of the hoop in the future </li>
                <li> Mocap Room: To get exact coordinates of drone and hoop </li>
            </ul>
            <p>On VICON Tracker App, we could create objects for the hoop and drone based on the markers and create the body coordinate frame as well. </p>   
            <p>Localizing the hoop: </p>
            <ul class="formatted-list">
                <li> We attached 4 IR-reflecting markers to the hoop </li>
                <li> Define the center of mass to be the average of these 4 points, which will be the midpoint of the hoop </li>
                <li> Configure Vicon to publish this position to a rostopic. Vicon publishes points at ~125 Hz. </li>
            </ul>

            <p>Localizing the drone: </p>
            <ul class="formatted-list">
                <li> We attached 5 IR-reflecting markers to the drone in an asymmetrical manner </li>
                <li> Asymmetrical configuration reduces ambiguity in marker identification of body </li>
                <li> Define the origin to be the top marker on the marker configuration. Configure Vicon to publish this position to a rostopic. </li>
            </ul>

            <div class="image-container">
                <img src="assets/images/vicon.png" alt="Vicon Tracker App">
                <p class="image-caption">Figure 3: Visualization of drone and hoop objects on Vicon</p>
            </div>
            
            <p>Controlling the drone using Tello SDK: </p>
            <ul class="formatted-list">
                <li> Use DJITelloPy, a wrapper of the Tello SDK </li>
                <li> Connect laptop to the Tello Wifi </li>
                <li>Useful commands:
                    <ul class="formatted-list">
                        <li><code>send_rc_control(left_right_velocity, forward_backward_velocity, up_down_velocity, yaw_velocity)</code></li>
                        <li><code>go_xyz_speed(x, y, z, speed)</code></li>
                    </ul>
                </li>
                <li> Use ROS to transform Vicon world coordinates into drone coordinates </li>
            </ul>
            
            <p>Now, let's go through the chronological steps of the entire process for the hoop-passing controller:  </p>
            <ol class="formatted-list">
                <li>Drone Takeoff</li>
                <li>Drone Warm-up (move forward as fast as possible)</li>
                <li>Hoop is thrown into the air</li>
                <li>Hoop Trajectory Prediction</li>
                <li>Drone uses trajectory to determine point to go to</li>
                <li>Drone control using Tello SDK to go to in the direction of the desired point at a desired velocity</li>
            </ol>

            <p>Predicting the Hoop’s Trajectory: </p>
            <div class="image-container">
                <img src="assets/images/hoop_traj.png" alt="Hoop Trajectory Prediction">
                <p class="image-caption">Figure 4: The motion along each axis can be modeled as a parabola. Trying to find a parameter matrix that satisfies the above equation. </p>
            </div>

            <p><b>The solution is using LEAST SQUARES:</b> </p>
            <p> We are trying to solve $$x(t) = x_0 + v_0t + 0.5at^2$$ </p>
            <p> 6 unknowns: 3 for initial velocity, and 3 for initial position. Acceleration is known! </p>

            <div class="image-container">
                <img src="assets/images/lsq.png" alt="Throwing lsq">
                <p class="image-caption">Figure 5: This gives the equation to determine $\beta$, which is the params matrix at the bottom, where $v$ is the initial velocity and $p$ is the initial position. </p>
            </div>
            
            <p> Deciding on a point to fly through: </p>
            <ul class="formatted-list">
                <li> Point that the hoop will be at .1 seconds before hitting the ground </li>
                <li>Gives the drone the most time to reach it
                    <ul class="formatted-list">
                        <li>The drone is <b>slow</b>, so this is important </li>
                    </ul>
                </li>
            </ul>

            <div class="image-container">
                <img src="assets/images/0.1secs.png" alt="0.1 secs">
                <p class="image-caption">Figure 6: Illustration of the intent of our picked feasible point </p>
            </div>
            
            <p> <b>Challenges with the thrown hoop-passing problem: </b>  </p>
            <ul class="formatted-list">
                <li>The drone is slow
                    <ul class="formatted-list">
                        <li>Max allowed speed is 1 m/s</li>
                    </ul>
                </li>
                <li>Gravity is strong
                    <ul class="formatted-list">
                        <li>The hoop is only in the air for at most 2 seconds</li>
                    </ul>
                </li>
                <li>MoCap room loses tracking if the hoop goes above a certain height (~2m)</li>
                <li>Although the drone acknowledges a command, it acts on it after some random time
                    <ul class="formatted-list">
                        <li>Tries to solve this using forward warmup</li>
                    </ul>
                </li>
                <li>Least Squares with few data points is susceptible to noise, even on the order of millimeters
                </li>
            </ul>

            <p style="font-size: 24px; font-weight: bold;">We couldn’t get the hoop-throwing pass through to work. So we tried rolling it instead.</p>
            

            <p> How to Predict Rolling Hoop Trajectory: Use Least Squares!  </p>
            <ul class="formatted-list">
                <li>4 unknowns: 2 for initial velocity, and 2 for initial position
                    <ul class="formatted-list">
                        <li>Acceleration is known — assumed to be constantly 0 (no friction)!</li>
                    </ul>
                </li>
                <li>First approach: 
                    <ul class="formatted-list">
                        <li>Determine the required velocity to go to a future point (time is known) and go at the required velocity – due to latency, required velocity isn’t enough</li>
                    </ul>
                </li>
                <li>First approach does not work, since required velocity is not enough, due to variable latency, and even with rolling hoop, drone is very slow in general</li>
                    <ul class="formatted-list">
                        <li>Go to feasible point (within bounds of command) at top speed</li>
                    </ul>
                <li>Feasible point is the first point that satisfies the requirement of the required velocity being the cap of $1 m/s$. This can be determined by finding the distance between the point and drone's current position, and dividing it by the known time for the hoop to reach that point.</li>
            </ul>

            <div class="image-container">
                <img src="assets/images/rolling_params.png" alt="rolling params" style="width: 50px; height: 20px;">
                <p class="image-caption">Figure 7: Unknown params to calculate using least squares. $v$ is initial velocity and $p$ is initial position.</p>
            </div>            

            <!-- Video example -->
            <div class="video-container">
                <video controls width="640">
                    <source src="assets/videos/project-demo.mp4" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
                <p class="video-caption">Project Implementation Demonstration</p>
            </div>
        </section>

        <section id="results">
            <h2>Results</h2>
            <p>Project outcomes and performance details.</p>
            
            <!-- Multiple images example -->
            <div class="image-gallery">
                <img src="assets/images/result-1.jpg" alt="Result Visualization 1">
                <img src="assets/images/result-2.jpg" alt="Result Visualization 2">
                <p class="image-caption">Figures showing project results</p>
            </div>
        </section>

        <section id="conclusion">
            <h2>Conclusion</h2>
            <p>Final thoughts and project summary.</p>
            
            <!-- Complex equation example -->
            <p>Our performance can be mathematically described as:
                $$\text{Performance} = \int_0^T \left(\frac{\text{Output}_t}{\text{Input}_t}\right) dt$$
            </p>
        </section>

        <section id="team">
            <h2>Team</h2>
            <p>Team member information.</p>
            
            <!-- Team member images -->
            <div class="team-gallery">
                <img src="assets/images/team-member-1.jpg" alt="Team Member 1">
                <img src="assets/images/team-member-2.jpg" alt="Team Member 2">
                <img src="assets/images/team-member-3.jpg" alt="Team Member 3">
            </div>
        </section>

        <section id="additional-materials">
            <h2>Additional Materials</h2>
            <p>Links to code, resources, and supplementary information.</p>
        </section>
    </main>

    <footer>
        <p>© 2024 Robotics Project Team</p>
    </footer>

    <script src="js/main.js"></script>
</body>
</html>